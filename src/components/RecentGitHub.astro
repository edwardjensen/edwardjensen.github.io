---
// Component for displaying recent GitHub contributions
interface GitHubRepo {
  name: string;
  description: string;
  html_url: string;
  updated_at: string;
}

// Filter repos updated since 2025-01-01 and sort by updated date
function filterAndSortRepos(repos: GitHubRepo[]): GitHubRepo[] {
  const cutoffDate = new Date('2025-01-01');
  return repos
    .filter(repo => new Date(repo.updated_at) >= cutoffDate)
    .sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())
    .slice(0, 5);
}

// Format date like Jekyll's date filter
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  const day = date.getDate();
  const month = date.toLocaleDateString('en-US', { month: 'long' });
  const year = date.getFullYear();
  return `${day} ${month} ${year}`;
}

// Fetch GitHub data
let recentRepos: GitHubRepo[] = [];

try {
  const response = await fetch('https://api.github.com/users/edwardjensen/repos');
  const repos = await response.json();
  recentRepos = filterAndSortRepos(repos);
} catch (error) {
  console.error('Failed to fetch GitHub repos:', error);
}
---

<div class="space-y-4">
  <h3 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Recent public GitHub contributions</h3>
  
  <ul class="space-y-3 mt-3 mb-3">
    {recentRepos.length > 0 ? recentRepos.map((repo) => (
      <li class="leading-4">
        <a href={repo.html_url} 
           target="_blank" 
           class="font-semibold hover:underline text-gray-900 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400">
          {repo.name}
        </a>
        <span class="ml-2 text-gray-700 dark:text-gray-300">{repo.description || 'No description'}</span>
        <span class="italic ml-2 text-gray-600 dark:text-gray-400">(last updated {formatDate(repo.updated_at)})</span>
      </li>
    )) : (
      <li class="text-center text-gray-600 dark:text-gray-400 py-4">
        <p>Recent GitHub activity will appear here.</p>
        <p class="text-sm mt-2">Loading from GitHub API...</p>
      </li>
    )}
  </ul>
</div>

