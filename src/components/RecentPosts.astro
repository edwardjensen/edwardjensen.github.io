---
// Component for displaying recent blog posts from edwardjensen.net
interface Post {
  url: string;
  title: string;
  image: string;
  image_alt_text: string;
  date_published: string;
}

// Fetch recent posts from JSON feed
let recentPosts: Post[] = [];
let additionalPosts: Post[] = [];

try {
  const response = await fetch('https://www.edwardjensen.net/feed.json');
  const data = await response.json();
  recentPosts = data.items.slice(0, 3);
  additionalPosts = data.items.slice(3, 13); // Show 10 additional posts
} catch (error) {
  console.error('Failed to fetch blog posts:', error);
}

// Format date like Jekyll's date filter
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  const day = date.getDate();
  const month = date.toLocaleDateString('en-US', { month: 'long' });
  const year = date.getFullYear();
  return `${day} ${month} ${year}`;
}
---

<div class="space-y-6">
  <h3 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Recent writing</h3>
  
  <!-- Featured recent posts -->
  <div class="flex flex-col space-y-6">
    {recentPosts.length > 0 ? recentPosts.map((post) => (
      <div class="py-3">
        <a href={post.url} target="_blank">
          <img 
            src={post.image} 
            alt={post.image_alt_text}
            class="w-full h-auto rounded-xl hover:blur-[1px] transition duration-300"
          />
          <div class="flex flex-col items-center mt-2">
            <h3 class="text-2xl font-bold">
              <a href={post.url} 
                 target="_blank"
                 class="text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 hover:underline">
                {post.title}
              </a>
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              {formatDate(post.date_published)}
            </p>
          </div>
        </a>
      </div>
    )) : (
      <div class="py-3">
        <div class="text-center text-gray-600 dark:text-gray-400">
          <p>Recent posts from edwardjensen.net will appear here.</p>
          <p class="text-sm mt-2">Loading external feed...</p>
        </div>
      </div>
    )}
  </div>
  
  <!-- Additional recent posts list -->
  {additionalPosts.length > 0 && (
    <div class="mt-8">
      <h4 class="text-xl italic mb-4 text-gray-900 dark:text-gray-100">Also recently...</h4>
      <ul class="leading-5 space-y-1">
        {additionalPosts.map((post) => (
          <li>
            <a href={post.url} 
               target="_blank"
               class="font-bold uppercase text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 hover:underline">
              {post.title}
            </a>
            <span class="ml-2 text-gray-700 dark:text-gray-300 text-sm">
              {formatDate(post.date_published)}
            </span>
          </li>
        ))}
      </ul>
    </div>
  )}
</div>

